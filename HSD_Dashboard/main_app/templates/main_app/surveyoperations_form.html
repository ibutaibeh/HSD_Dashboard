{% extends 'base.html' %}
{% block content %}

<div class="row">
  <div class="col s12">
    {% if object %}
      <h4 class="light-blue-text text-darken-4">
        <i class="material-icons left">edit</i>Edit Survey Operation
      </h4>
      <p class="grey-text">Editing: <strong class="teal-text">{{ object.survey_name }}</strong></p>
    {% else %}
      <h4 class="light-blue-text text-darken-4">
        <i class="material-icons left">add</i>Add Survey Operations
      </h4>
      <p class="grey-text">Create a new survey operation</p>
    {% endif %}
  </div>
</div>

<div class="row">
  <div class="col s12 m4">
    <div class="card">
      <div class="card-content">
        <span class="card-title light-blue-text text-darken-4">
          <i class="material-icons left">assignment</i>Survey Details
        </span>
        
        <form action="" method="post">
          {% csrf_token %}
          {% for field in form %}
          {% if field.name != 'location'%}
          <div>
            {{field.label_tag}}
            {{field}}
          </div>
          {% endif %}
          {% endfor %}
          <label for="id_location">Location</label>
          <textarea name="location" id="id_location" rows="4" cols="50">{% if location4326 %}{{ location4326|safe }}{% endif %}</textarea>
          <input type="submit" value="Submit!" class="btn">
          <a href="{% url 'survey_index' %}" class="btn grey lighten-1 waves-effect waves-light">
            <i class="material-icons left">cancel</i>Cancel
          </a>
        </form>
      </div>
    </div>
  </div>

  <div class="col s12 m8">
    <div class="card">
      <div class="card-content">
        <span class="card-title light-blue-text text-darken-4">
          <i class="material-icons left">map</i>Survey Area Location
        </span>
        <p class="grey-text">Click on the map to set the survey location</p>
        
        <div id="map" style="height: 400px; width: 100%; border-radius: 4px; overflow: hidden;">
        </div>
        {% if location4326 %}
<script>
  var existingPolygon = JSON.parse('{{ location4326|escapejs }}');
  existingPolygon = JSON.parse(JSON.stringify(existingPolygon));
  L.geoJSON(existingPolygon).addTo(map);
  //map.fitBounds(L.geoJSON(existingPolygon).getBounds());
</script>
{% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}